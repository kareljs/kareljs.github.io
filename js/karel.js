var mapDefinition = [
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G']
];



var texGround 	  = PIXI.Texture.fromImage("assets/ground.png");
var texWall   	  = PIXI.Texture.fromImage("assets/wall.png");
var texBip 	  	  = PIXI.Texture.fromImage("assets/bip.png");
var texKarelFront = PIXI.Texture.fromImage("assets/karelFront.png");
var texKarelBack  = PIXI.Texture.fromImage("assets/karelBack.png");
var texKarelLeft  = PIXI.Texture.fromImage("assets/karelLeft.png");
var texKarelRight = PIXI.Texture.fromImage("assets/karelRight.png");
var texMsgShutOff = PIXI.Texture.fromImage("assets/karelShutOffMsg.png");

var renderWidth = 550;
var renderHeight = 550;

var map;
var mapEditor;

var menu;
var menuEditor;

var stage;
var stageEditor;

var running = true;

var mapDefinitionInitial;

$(document).ready(function(){
	start();
});

$(document).keyup(function(e){
	if(e.which == 32)//Space
		robotMove();
	if(e.which == 37)//LeftArrow
		resetMap(mapDefinitionInitial);
	if(e.which == 71)//G
		loadEditedMap();
	if(e.which == 68)//D
		robotPutBip();
});

function start(){

	mapDefinitionInitial = mapDefinition.map(function(arr) {
		return arr.slice();
	});

	stage = new PIXI.Stage(0xFFFFFF);
	stageEditor = new PIXI.Stage(0x000000);

	var renderer = PIXI.autoDetectRenderer(renderWidth, renderHeight);
	var rendererEditor = PIXI.autoDetectRenderer(renderWidth, renderHeight);

	$("#mapa").append(renderer.view);
	$("#editormapa").append(rendererEditor.view);

	//document.body.appendChild(renderer.view);

	requestAnimFrame( animate );
	requestAnimFrame( animateEditor );

	map = new MapKarel(mapDefinition, false);
	stage.addChild(map);
	mapEditor = new MapKarel(mapDefinition, true);
	stageEditor.addChild(mapEditor);

	menu = new Menu(map);
	stage.addChild(menu);

	menuEditor = new Menu(mapEditor);
	stageEditor.addChild(menuEditor);

	function animate() {
		requestAnimFrame( animate );
        // render the stage
        renderer.render(stage);
    }

    function animateEditor() {
    	requestAnimFrame( animateEditor );
    	rendererEditor.render(stageEditor);
    }

}


function robotMove(){

	if(!running)
		return false;

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
		nextR = map.robot.mapPosR - 1;
		nextC = map.robot.mapPosC;
		break;
		case('E'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC + 1;
		break;
		case('S'):
		nextR = map.robot.mapPosR + 1;
		nextC = map.robot.mapPosC;
		break;
		case('W'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC - 1;
		break;
	}
	//Verify if it is a valid movement
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	map.robot.position.x = map.getMapTile(nextC, nextR).position.x;
	map.robot.position.y = map.getMapTile(nextC, nextR).position.y;
	map.robot.mapPosR = nextR;
	map.robot.mapPosC = nextC;

	return true;
}

function robotTurn(){

	if(!running)
		return false;

	switch(map.robot.direction){
		case('N'):
		map.robot.direction = 'W';
		map.robot.setTexture(texKarelLeft);
		break;
		case('E'):
		map.robot.direction = 'N';
		map.robot.setTexture(texKarelBack);
		break;
		case('S'):
		map.robot.direction = 'E';
		map.robot.setTexture(texKarelRight);
		break;
		case('W'):
		map.robot.direction = 'S';
		map.robot.setTexture(texKarelFront);
		break;
	}

	return true;
}

function robotGetBip(){

	if(!running)
		return false;

	if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype == 'B'){
		if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips == 1){
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).setTexture(texGround);
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype = 'G';
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips = 0;
		}else{
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips--;
		}

		map.robot.bipBag++;
		return true;
	}else{
		return false;
	}
}

function robotPutBip(){

	if(!running)
		return false;

	if(map.robot.bipBag > 0){
		if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype == 'B'){
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips++;
			map.robot.bipBag--;
		}else{
			if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype == 'G'){
				map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).setTexture(texBip);
				map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype = 'B';
				map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips = 1;
				map.robot.bipBag--;
			}else{
				return false;
			}
		}
		return true;
	}else{
		return false;
	}
}

function robotFrontFree(){

	if(!running)
		return false;

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
		nextR = map.robot.mapPosR - 1;
		nextC = map.robot.mapPosC;
		break;
		case('E'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC + 1;
		break;
		case('S'):
		nextR = map.robot.mapPosR + 1;
		nextC = map.robot.mapPosC;
		break;
		case('W'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC - 1;
		break;
	}
	//Verify
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	return true;
}

function robotRightFree(){

	if(!running)
		return false;

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC + 1;
		break;
		case('E'):
		nextR = map.robot.mapPosR + 1;
		nextC = map.robot.mapPosC;
		break;
		case('S'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC - 1;
		break;
		case('W'):
		nextR = map.robot.mapPosR - 1;
		nextC = map.robot.mapPosC;
		break;
	}
	//Verify
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	return true;
}

function robotLeftFree(){

	if(!running)
		return false;

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC - 1;
		break;
		case('E'):
		nextR = map.robot.mapPosR - 1;
		nextC = map.robot.mapPosC;
		break;
		case('S'):
		nextR = map.robot.mapPosR;
		nextC = map.robot.mapPosC + 1;
		break;
		case('W'):
		nextR = map.robot.mapPosR + 1;
		nextC = map.robot.mapPosC;
		break;
	}
	//Verify
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	return true;
}

function robotNearBip(){

	if(!running)
		return false;

	if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype == 'B')
		return true;
	else
		return false;
}

function robotBipOnBag(){

	if(!running)
		return false;

	if(map.robot.bipBag > 0)
		return true;
	else
		return false;
}

function robotShutOff(){

	if(running)
		running = false;
	else
		return false;

	var msg = new PIXI.Sprite(texMsgShutOff);
	msg.position.x = (renderWidth - texMsgShutOff.width)/2;
	msg.position.y = (renderHeight - texMsgShutOff.height)/2;
	msg.interactive = true;
	msg.mouseup = msg.touchend = function(data){
		stage.removeChild(this);
	}
	stage.addChild(msg);
}

function robotDirNoth(){

	if(!running)
		return false;

	if(map.robot.direction == 'N')
		return true;
	else
		return false;
}

function robotDirEast(){

	if(!running)
		return false;

	if(map.robot.direction == 'E')
		return true;
	else
		return false;
}

function robotDirSouth(){
	
	if(!running)
		return false;

	if(map.robot.direction == 'S')
		return true;
	else
		return false;
}

function robotDirWest(){
	
	if(!running)
		return false;

	if(map.robot.direction == 'W')
		return true;
	else
		return false;
}

function resetMap(newMapDefinition){

	stageEditor.removeChild(mapEditor);
	stageEditor.removeChild(menuEditor);
	mapEditor = new MapKarel(newMapDefinition, true);
	stageEditor.addChild(mapEditor);
	menuEditor = new Menu(mapEditor);
	stageEditor.addChild(menuEditor);

	stage.removeChild(map);
	stage.removeChild(menu);
	map = new MapKarel(newMapDefinition, false);
	stage.addChild(map);
	menu = new Menu(map);
	stage.addChild(menu);

	running = true;
}

function loadEditedMap(){
	mapDefinition = mapEditor.mapDefinition.map(function(arr) {
		return arr.slice();
	});
	mapDefinitionInitial = mapEditor.mapDefinition.map(function(arr) {
		return arr.slice();
	});

	resetMap(mapDefinition);
}

function changeBrush(newBrush){
	switch(newBrush){
		case 0:
		mapEditor.currentBrush = 'G';
		break;
		case 1:
		mapEditor.currentBrush = 'W';
		break;
		case 2:
		mapEditor.currentBrush = 'B';
		break;
		default:
		mapEditor.currentBrush = 'G';
	}
}

//-----------------------------------------------------------------

//Map Class--------------------------------------------------------

MapKarel.prototype = new PIXI.DisplayObjectContainer();
MapKarel.prototype.constructor = MapKarel;
//Width and height in tiles, not in pixels
function MapKarel(mapDef, editMode){
	PIXI.DisplayObjectContainer.call(this);
	this.interactive = true;

	this.mapDefinition = mapDef.map(function(arr) {
		return arr.slice();
	});
	this.mapWidth = this.mapDefinition[0].length;
	this.mapHeight = this.mapDefinition.length;
	this.mapTileSize = 100;

	this.generateMap(this.mapDefinition);
	this.generateRobot();

	this.editMode = editMode;
	this.currentBrush = 'B';

	//-----------------------------------------
	this.mapZoomMax = (renderHeight)/this.height;
	this.mapZoom = this.mapZoomMax;
	this.scale.x = this.scale.y = this.mapZoom;
	//-----------------------------------------

	//Drag map-----------------------------------------------
	this.mousePressPoint = [0, 0];

	this.mousedown = this.touchstart = function(data){
		this.dragging = true;
		this.mousePressPoint[0] = data.getLocalPosition(this.parent).x - this.position.x;
		this.mousePressPoint[1] = data.getLocalPosition(this.parent).y - this.position.y;
	};
	this.mouseup = this.mouseupoutside = this.touchend = this.touchendoutside = function(data){
		this.dragging = false;
	};
	this.mousemove = this.touchmove = function(data){
		if(this.dragging){
			var position = data.getLocalPosition(this.parent);
			this.position.x = position.x - this.mousePressPoint[0];
			this.position.y = position.y - this.mousePressPoint[1];

			this.constrainMapKarel();
		}
	};
  	//-------------------------------------------------------

  }

  MapKarel.prototype.generateRobot =  function(){
  	this.robot = new PIXI.Sprite(texKarelRight);
	//-------------
	this.robot.direction = 'E';
	this.robot.mapPosR = this.mapDefinition.length-1;
	this.robot.mapPosC = 0;
	this.robot.bipBag = 0;
	//-------------
	this.robot.anchor.x = 0.5;
	this.robot.anchor.y = 0.7;
	this.robot.position.x = this.getMapTile(this.robot.mapPosC, this.robot.mapPosR).position.x;
	this.robot.position.y = this.getMapTile(this.robot.mapPosC, this.robot.mapPosR).position.y;

	this.addChild(this.robot);
}

MapKarel.prototype.generateMap = function(mapDef){

	for(var row = 0; row < mapDef.length; row++){
		for(var col = 0; col < mapDef[0].length; col++){
			this.addMapTile(col, row, mapDef[row][col]);
		}
	}

}

MapKarel.prototype.addMapTile = function(x, y, type){

	var block;
	switch(type){
		case 'G':
		block = new PIXI.Sprite(texGround);
		block.ktype = 'G';
		block.bips = 0;
		break;
		case 'W':
		block = new PIXI.Sprite(texWall);
		block.ktype = 'W';
		block.bips = 0;
		break;
		case 'B':
		block = new PIXI.Sprite(texBip);
		block.ktype = 'B';
		block.bips = 1;
		break;
		default:
		block = new PIXI.Sprite(texGround);
		block.ktype = 'G';
		block.bips = 0;
	}
	block.mapPosition = [x,y];
	block.anchor.x = 0.5;
	block.anchor.y = 0.5;
	block.position.x = x*this.mapTileSize + this.mapTileSize/2;
	block.position.y = y*this.mapTileSize + this.mapTileSize/2;
	block.interactive = true;
	block.mousedown = block.touchstart = function(mouseData){
		block.firstTouch = mouseData.getLocalPosition(this.parent);
	}
	block.mouseup = block.touchend = function(mouseData){
		if(this.parent.editMode){
			if(this.firstTouch.x != mouseData.getLocalPosition(this.parent).x || this.firstTouch.y != mouseData.getLocalPosition(this.parent).y)
				return;

			switch(this.parent.currentBrush){
				case 'G':
				this.setTexture(texGround);
				this.bips = 0;
				break;
				case 'W':
				if(this.mapPosition[0] == 0 && this.mapPosition[1] == mapDefinition.length - 1){
					return;
				}
				this.setTexture(texWall);
				this.bips = 0;
				break;
				case 'B':
				if(this.ktype == 'B'){
					this.bips++;
					return;
				}
				this.setTexture(texBip);
				this.bips = 1;
				break;
				default:
				this.setTexture(texGround);
				this.bips = 0;
			}
			this.ktype = this.parent.currentBrush;
			this.parent.mapDefinition[this.mapPosition[1]][this.mapPosition[0]] = this.parent.currentBrush;
		}
	};
	this.addChild(block, y * this.mapWidth + x);

}

MapKarel.prototype.changeMapTile = function(x, y, type){
	this.removeChild(this.getMapTile(x,y));
	this.addMapTile(x, y, type);
}

MapKarel.prototype.getMapTile = function(x, y){
	return this.getChildAt(y * this.mapWidth + x);
}

MapKarel.prototype.constrainMapKarel = function(){
	this.position.x = Math.max(this.position.x, -1 * this.mapTileSize * this.mapWidth * this.mapZoom + renderWidth);
	this.position.x = Math.min(this.position.x, 0);
	this.position.y = Math.max(this.position.y, -1 * this.mapTileSize * this.mapHeight * this.mapZoom + renderHeight);
	this.position.y = Math.min(this.position.y, 0);
}

MapKarel.prototype.zoomIn = function(){
	this.mapZoom = Math.min(this.mapZoom * 2, 4);
	this.scale.x = this.scale.y = this.mapZoom;

	this.constrainMapKarel();
}

MapKarel.prototype.zoomOut = function(){
	this.mapZoom = Math.max(this.mapZoom / 2, this.mapZoomMax);
	this.scale.x = this.scale.y = this.mapZoom;

	this.constrainMapKarel();
}

//--------------------------------------------------------------

Menu.prototype = new PIXI.DisplayObjectContainer();
Menu.prototype.constructor = Menu;

function Menu(Map){
	PIXI.DisplayObjectContainer.call(this);

	this.map = Map;

	this.interactive = true;

	//Create +zoomin button
	var btnZoomIn = new PIXI.Text('+', { font: "40px Arial", fill: "#FFFFFF"});
	btnZoomIn.position.x = 20;
	btnZoomIn.position.y = 20;
	btnZoomIn.interactive = true;
	btnZoomIn.buttonMode = true;
	btnZoomIn.hitArea = new PIXI.Rectangle(0,0,30,30);
	btnZoomIn.mousedown = btnZoomIn.touchstart = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FF0000" });
	};
	btnZoomIn.mouseover = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFF00" });
	};
	btnZoomIn.mouseup = btnZoomIn.touchend = function(data){
		this.parent.map.zoomIn();
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomIn.mouseupoutside = btnZoomIn.touchendoutside = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomIn.mouseout = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};

	this.addChild(btnZoomIn);

	//Create -zoomout button
	var btnZoomOut = new PIXI.Text('-', { font: "40px Arial", fill: "#FFFFFF"});
	btnZoomOut.position.x = 50;
	btnZoomOut.position.y = 20;
	btnZoomOut.interactive = true;
	btnZoomOut.buttonMode = true;
	btnZoomOut.hitArea = new PIXI.Rectangle(0,0,30,30);
	btnZoomOut.mousedown = btnZoomOut.touchstart = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FF0000" });
	};
	btnZoomOut.mouseover = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFF00" });
	};
	btnZoomOut.mouseup = btnZoomOut.touchend = function(data){
		this.parent.map.zoomOut();
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomOut.mouseupoutside = btnZoomOut.touchendoutside = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomOut.mouseout = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};

	this.addChild(btnZoomOut);
}
