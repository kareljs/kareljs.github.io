

var mapDefinition = [
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G'],
			['G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G', 'G']
			];



var texGround 	  = PIXI.Texture.fromImage("assets/ground.png");
var texWall   	  = PIXI.Texture.fromImage("assets/wall.png");
var texBip 	  	  = PIXI.Texture.fromImage("assets/bip.png");
var texKarelFront = PIXI.Texture.fromImage("assets/karelFront.png");
var texKarelBack  = PIXI.Texture.fromImage("assets/karelBack.png");
var texKarelLeft  = PIXI.Texture.fromImage("assets/karelLeft.png");
var texKarelRight = PIXI.Texture.fromImage("assets/karelRight.png");

var renderWidth = 800;
var renderHeight = 800;

var map;
var menu;
var stage;

var editMode = true;
var currentBrush = 'B';

$(document).ready(function(){
	start();
});

$(document).keyup(function(e){
	if(e.which == 32)//Space
		robotMove();
	if(e.which == 37)//LeftArrow
		robotTurn();
	if(e.which == 71)//G
		robotGetBip();
	if(e.which == 68)//D
		robotPutBip();
});

function start(){

	stage = new PIXI.Stage(0xFFFFFF);

	var renderer = PIXI.autoDetectRenderer(renderWidth, renderHeight);

	document.body.appendChild(renderer.view);

	requestAnimFrame( animate );

	map = new MapKarel(mapDefinition);
	stage.addChild(map);

	menu = new Menu();
	stage.addChild(menu);

	function animate() {
 
        requestAnimFrame( animate );
 
        // render the stage
        renderer.render(stage);
    }

}


function robotMove(){

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
			nextR = map.robot.mapPosR - 1;
			nextC = map.robot.mapPosC;
			break;
		case('E'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC + 1;
			break;
		case('S'):
			nextR = map.robot.mapPosR + 1;
			nextC = map.robot.mapPosC;
			break;
		case('W'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC - 1;
			break;
	}
	//Verify if it is a valid movement
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	map.robot.position.x = map.getMapTile(nextC, nextR).position.x;
	map.robot.position.y = map.getMapTile(nextC, nextR).position.y;
	map.robot.mapPosR = nextR;
	map.robot.mapPosC = nextC;

	return true;
}

function robotTurn(){

	switch(map.robot.direction){
		case('N'):
			map.robot.direction = 'W';
			map.robot.setTexture(texKarelLeft);
			break;
		case('E'):
			map.robot.direction = 'N';
			map.robot.setTexture(texKarelBack);
			break;
		case('S'):
			map.robot.direction = 'E';
			map.robot.setTexture(texKarelRight);
			break;
		case('W'):
			map.robot.direction = 'S';
			map.robot.setTexture(texKarelFront);
			break;
	}

	return true;
}

function robotGetBip(){

	if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype == 'B'){
		if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips == 1){
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).setTexture(texGround);
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype = 'G';
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips = 0;
		}else{
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips--;
		}
		
		map.robot.bipBag++;
		return true;
	}else{
		return false;
	}

}

function robotPutBip(){

	if(map.robot.bipBag > 0){
		if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype == 'B'){
			map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips++;
			map.robot.bipBag--;
		}else{
			if(map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype == 'G'){
				map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).setTexture(texBip);
				map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).ktype = 'B';
				map.getMapTile(map.robot.mapPosC, map.robot.mapPosR).bips = 1;
				map.robot.bipBag--;
			}else{
				return false;
			}
		}
		return true;
	}else{
		return false;
	}

}

function robotFrontFree(){

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
			nextR = map.robot.mapPosR - 1;
			nextC = map.robot.mapPosC;
			break;
		case('E'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC + 1;
			break;
		case('S'):
			nextR = map.robot.mapPosR + 1;
			nextC = map.robot.mapPosC;
			break;
		case('W'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC - 1;
			break;
	}
	//Verify
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	return true;
}

function robotRightFree(){

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC + 1;
			break;
		case('E'):
			nextR = map.robot.mapPosR + 1;
			nextC = map.robot.mapPosC;
			break;
		case('S'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC - 1;
			break;
		case('W'):
			nextR = map.robot.mapPosR - 1;
			nextC = map.robot.mapPosC;
			break;
	}
	//Verify
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	return true;

}

function robotLeftFree(){

	var nextR;
	var nextC;

	switch(map.robot.direction){
		case('N'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC - 1;
			break;
		case('E'):
			nextR = map.robot.mapPosR - 1;
			nextC = map.robot.mapPosC;
			break;
		case('S'):
			nextR = map.robot.mapPosR;
			nextC = map.robot.mapPosC + 1;
			break;
		case('W'):
			nextR = map.robot.mapPosR + 1;
			nextC = map.robot.mapPosC;
			break;
	}
	//Verify
	if(nextR < 0 || nextR >= map.mapHeight){
		return false;
	}
	if(nextC < 0 || nextC >= map.mapWidth){
		return false;
	}
	if(map.getMapTile(nextC, nextR).ktype == 'W'){
		return false;
	}
	//if yes
	return true;

}

function robotNearBip(){

	if(map.getMapTile(nextC, nextR).ktype == 'B')
		return true;
	else
		return false;

}

function robotBipOnBag(){

	if(map.robot.bipBag > 0)
		return true;
	else
		return false;

}

function robotShutOff(){

	//Preciso fazer uma imagem para o robo desligado

}

function robotDirNoth(){
	if(map.robot.direction == 'N')
		return true;
	else
		return false;
}

function robotDirEast(){
	if(map.robot.direction == 'E')
		return true;
	else
		return false;
}

function robotDirSouth(){
	if(map.robot.direction == 'S')
		return true;
	else
		return false;
}

function robotDirWest(){
	if(map.robot.direction == 'W')
		return true;
	else
		return false;
}


//-----------------------------------------------------------------

//Map Class--------------------------------------------------------

MapKarel.prototype = new PIXI.DisplayObjectContainer();
MapKarel.prototype.constructor = MapKarel;
//Width and height in tiles, not in pixels
function MapKarel(mapDef){
	PIXI.DisplayObjectContainer.call(this);
	this.interactive = true;

	this.mapDefinition = mapDef;
	this.mapWidth = this.mapDefinition[0].length;
	this.mapHeight = this.mapDefinition.length;
	this.mapTileSize = 100;

	this.generateMap(this.mapDefinition);
	this.generateRobot();

	//-----------------------------------------
	this.mapZoomMax = (renderHeight)/this.height;
	this.mapZoom = this.mapZoomMax;
	this.scale.x = this.scale.y = this.mapZoom;
	//-----------------------------------------

	//Drag map-----------------------------------------------
	this.mousePressPoint = [0, 0];

  	this.mousedown = this.touchstart = function(data){
  		this.dragging = true;
  		this.mousePressPoint[0] = data.getLocalPosition(this.parent).x - this.position.x;
		this.mousePressPoint[1] = data.getLocalPosition(this.parent).y - this.position.y;
  	};
  	this.mouseup = this.mouseupoutside = this.touchend = this.touchendoutside = function(data){
  		this.dragging = false;
  	};
  	this.mousemove = this.touchmove = function(data){
  		if(this.dragging){
  			var position = data.getLocalPosition(this.parent);
  			this.position.x = position.x - this.mousePressPoint[0];
  			this.position.y = position.y - this.mousePressPoint[1];

  			this.constrainMapKarel();
  		}
  	};
  	//-------------------------------------------------------

}

MapKarel.prototype.generateRobot =  function(){
	this.robot = new PIXI.Sprite(texKarelBack);
	//-------------
	this.robot.direction = 'N';
	this.robot.mapPosR = this.mapDefinition.length-1;
	this.robot.mapPosC = 0;
	this.robot.bipBag = 0;
	//-------------
	this.robot.anchor.x = 0.5;
	this.robot.anchor.y = 0.7;
	this.robot.position.x = this.getMapTile(this.robot.mapPosC, this.robot.mapPosR).position.x;
	this.robot.position.y = this.getMapTile(this.robot.mapPosC, this.robot.mapPosR).position.y;

	this.addChild(this.robot);
}

MapKarel.prototype.generateMap = function(mapDef){

	for(var row = 0; row < mapDef.length; row++){
		for(var col = 0; col < mapDef[0].length; col++){
			this.addMapTile(col, row, mapDef[row][col]);
		}
	}

}

MapKarel.prototype.addMapTile = function(x, y, type){

	var block;
	switch(type){
		case 'G':
		block = new PIXI.Sprite(texGround);
		block.ktype = 'G';
		break;
		case 'W':
		block = new PIXI.Sprite(texWall);
		block.ktype = 'W';
		break;
		case 'B':
		block = new PIXI.Sprite(texBip);
		block.ktype = 'B';
		break;
		default:
		block = new PIXI.Sprite(texGround);
		block.ktype = 'G';
	}
	block.anchor.x = 0.5;
	block.anchor.y = 0.5;
	block.position.x = x*this.mapTileSize + this.mapTileSize/2;
	block.position.y = y*this.mapTileSize + this.mapTileSize/2;
	block.bips = 0;
	block.interactive = true;
	block.click = function(mouseData){
		if(editMode){
			switch(currentBrush){
				case 'G':
				this.setTexture(texGround);
				this.ktype = 'G';
				this.bips = 0;
				break;
				case 'W':
				this.setTexture(texWall);
				this.ktype = 'W';
				this.bips = 0;
				break;
				case 'B':
				if(this.ktype == 'B'){
					this.bips++;
					break;
				}
				this.setTexture(texBip);
				this.ktype = 'B';
				this.bips = 1;
				break;
				default:
				this.setTexture(texGround);
				this.ktype = 'G';
				this.bips = 0;
			}
		}
	};
	this.addChild(block, y * this.mapWidth + x);

}

MapKarel.prototype.changeMapTile = function(x, y, type){
	this.removeChild(this.getMapTile(x,y));
	this.addMapTile(x, y, type);
}

MapKarel.prototype.getMapTile = function(x, y){
	return this.getChildAt(y * this.mapWidth + x);
}

MapKarel.prototype.constrainMapKarel = function(){
	this.position.x = Math.max(this.position.x, -1 * this.mapTileSize * this.mapWidth * this.mapZoom + renderWidth);
	this.position.x = Math.min(this.position.x, 0);
	this.position.y = Math.max(this.position.y, -1 * this.mapTileSize * this.mapHeight * this.mapZoom + renderHeight);
	this.position.y = Math.min(this.position.y, 0);
}

MapKarel.prototype.zoomIn = function(){
	this.mapZoom = Math.min(this.mapZoom * 2, 4);
	this.scale.x = this.scale.y = this.mapZoom;

	this.constrainMapKarel();
}

MapKarel.prototype.zoomOut = function(){
	this.mapZoom = Math.max(this.mapZoom / 2, this.mapZoomMax);
	this.scale.x = this.scale.y = this.mapZoom;

	this.constrainMapKarel();
}

//--------------------------------------------------------------

Menu.prototype = new PIXI.DisplayObjectContainer();
Menu.prototype.constructor = Menu;

function Menu(){
	PIXI.DisplayObjectContainer.call(this);

	this.interactive = true;

	//Create +zoomin button
	var btnZoomIn = new PIXI.Text('+', { font: "40px Arial", fill: "#FFFFFF"});
	btnZoomIn.position.x = 20;
	btnZoomIn.position.y = 20;
	btnZoomIn.interactive = true;
	btnZoomIn.buttonMode = true;
	btnZoomIn.hitArea = new PIXI.Rectangle(0,0,30,30);
	btnZoomIn.mousedown = btnZoomIn.touchstart = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FF0000" });
	};
	btnZoomIn.mouseover = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFF00" });
	};
	btnZoomIn.mouseup = btnZoomIn.touchend = function(data){
		map.zoomIn();
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomIn.mouseupoutside = btnZoomIn.touchendoutside = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomIn.mouseout = function(data){
		btnZoomIn.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};

	this.addChild(btnZoomIn);

	//Create -zoomout button
	var btnZoomOut = new PIXI.Text('-', { font: "40px Arial", fill: "#FFFFFF"});
	btnZoomOut.position.x = 50;
	btnZoomOut.position.y = 20;
	btnZoomOut.interactive = true;
	btnZoomOut.buttonMode = true;
	btnZoomOut.hitArea = new PIXI.Rectangle(0,0,30,30);
	btnZoomOut.mousedown = btnZoomOut.touchstart = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FF0000" });
	};
	btnZoomOut.mouseover = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFF00" });
	};
	btnZoomOut.mouseup = btnZoomOut.touchend = function(data){
		map.zoomOut();
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomOut.mouseupoutside = btnZoomOut.touchendoutside = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};
	btnZoomOut.mouseout = function(data){
		btnZoomOut.setStyle({ font: "40px Arial", fill: "#FFFFFF" });
	};

	this.addChild(btnZoomOut);
}
